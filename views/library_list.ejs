<link rel="stylesheet" href="/css/style.css">
<main id="library_list">
  <% const DOC_TYPE_LABEL={ form: '서식' , reference: '자료' , safety: '안전' , contract: '계약' }; %>
  
  <div class="page-head">
    <div class="head-actions">
      <a href="/library/new" class="btn btn-primary">자료 등록</a>
    </div>

    <form method="get" action="/library" class="search-form">
      <select name="type">
        <option value="all" <%= (type === 'all' || !type) ? 'selected' : '' %>>전체</option>
        <option value="form" <%= type === 'form' ? 'selected' : '' %>>서식</option>
        <option value="reference" <%= type === 'reference' ? 'selected' : '' %>>자료</option>
        <option value="safety" <%= type === 'safety' ? 'selected' : '' %>>안전</option>
        <option value="contract" <%= type === 'contract' ? 'selected' : '' %>>계약</option>
      </select>

      <input
        type="text"
        name="q"
        placeholder="제목/카테고리/메모/파일명 검색"
        value="<%= (typeof q !== 'undefined' ? q : '') %>"
      />

      <button class="btn" type="submit">검색</button>
      <button class="btn" type="button" onclick="window.location.href='/library'">새로고침</button>
    </form>
  </div>

  <div class="table-scroll">
    <table>
      <thead>
        <tr>
          <th class="text-center" style="width:70px;">No</th>
          <th style="width:120px;">구분</th>
          <th>제목</th>
          <th style="width:170px;">카테고리</th>
          <th style="width:260px;">파일</th>
          <th class="text-right" style="width:110px;">용량</th>
          <th class="text-center" style="width:130px;">등록일</th>
          <th class="text-center" style="width:90px;">수정</th>
        </tr>
      </thead>

      <tbody>
        <% if (docs && docs.length > 0) { %>
          <% docs.forEach((d) => { %>
            <tr>
              <td class="text-center"><%= d.row_no %></td>

              <td>
                <span class="pill">
                  <%= DOC_TYPE_LABEL[d.doc_type] || '-' %>
                </span>
              </td>

              <td>
                <a class="link" href="/library/<%= d.id %>"><%= d.title %></a>
              </td>

              <td><%= d.category || '-' %></td>

              <td><%= d.original_name || '-' %></td>

              <td class="text-right">
                <%= d.size ? Math.round(d.size / 1024) + ' KB' : '-' %>
              </td>

              <td class="text-center">
                <%= (d.created_at || '').toString().slice(0,10) %>
              </td>

              <td class="text-center">
                <a class="btn-ghost" href="/library/<%= d.id %>/edit">수정</a>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="8" class="text-center" style="color: var(--muted); padding: 18px;">
              등록된 자료가 없습니다.
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <% if (totalPages && totalPages > 1) { %>
    <div class="pagination" aria-label="Library pagination">
      <% for (let p = 1; p <= totalPages; p++) { %>
        <% if (p === currentPage) { %>
          <span class="page current"><%= p %></span>
        <% } else { %>
          <a class="page" href="/library?page=<%= p %><%= type ? '&type=' + encodeURIComponent(type) : '' %><%= q ? '&q=' + encodeURIComponent(q) : '' %>">
            <%= p %>
          </a>
        <% } %>
      <% } %>
    </div>
  <% } %>
</main>