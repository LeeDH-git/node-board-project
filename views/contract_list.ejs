<!-- 계약 목록 화면: /contract -->

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>계약 관리</h3>
  <a href="/contract/new" class="btn btn-primary">신규 계약 등록</a>
</div>

<form method="get" action="/contract" class="form-inline mb-3">
  <input
    type="text"
    name="q"
    class="form-control mr-2"
    placeholder="계약명으로 검색"
    value="<%= searchQuery || '' %>"
  />
  <button class="btn btn-outline-primary" type="submit">검색</button>
</form>

<table class="table table-striped table-hover table-sm">
  <thead>
    <tr>
      <th class="text-center" style="width: 60px;">No</th>
      <th style="width: 120px;">계약번호</th>
      <th>계약명</th>
      <th style="width: 140px;" class="text-center">발주처</th>
      <th style="width: 140px;" class="text-right">계약금액</th>
      <th style="width: 160px;" class="text-center">공사기간</th>
      <th style="width: 140px;" class="text-center">등록일</th>
      <th style="width: 80px;" class="text-center">수정</th>
    </tr>
  </thead>
  <tbody>
    <% if (contracts && contracts.length > 0) { %>
      <% contracts.forEach((c) => { %>
        <tr>
          <td class="text-center"><%= c.row_no %></td>

          <!-- 계약번호 -->
          <td><%= c.contract_no || '' %></td>

          <!-- 계약명: 상세로 링크 -->
          <td>
            <a href="/contract/<%= c.id %>">
              <%= c.title %>
            </a>
          </td>

          <!-- 발주처 -->
          <td class="text-center"><%= c.client_name || '' %></td>

          <!-- 계약금액 -->
          <td class="text-right">
            <%= c.total_amount ? c.total_amount.toLocaleString("ko-KR") : '' %>
          </td>

          <!-- 공사기간 -->
          <td class="text-center">
            <% if (c.start_date || c.end_date) { %>
              <%= c.start_date || '' %> ~ <%= c.end_date || '' %>
            <% } else { %>
              -
            <% } %>
          </td>

          <!-- 등록일 -->
          <td class="text-center"><%= c.created_at || '' %></td>

          <!-- 수정 버튼 -->
          <td class="text-center">
            <a href="/contract/<%= c.id %>/edit" class="btn btn-sm btn-outline-secondary">
              수정
            </a>
          </td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr>
        <td colspan="8" class="text-center text-muted">
          등록된 계약이 없습니다.
        </td>
      </tr>
    <% } %>
  </tbody>
</table>

<!-- 간단한 페이징 (필요 없으면 밑에 블럭 통째로 지워도 됨) -->
<% if (totalPages && totalPages > 1) { %>
  <nav aria-label="Contract pagination">
    <ul class="pagination pagination-sm justify-content-center">
      <% for (let p = 1; p <= totalPages; p++) { %>
        <li class="page-item <%= p === currentPage ? 'active' : '' %>">
          <a class="page-link" href="/contract?page=<%= p %>&q=<%= encodeURIComponent(searchQuery || '') %>">
            <%= p %>
          </a>
        </li>
      <% } %>
    </ul>
  </nav>
<% } %>
