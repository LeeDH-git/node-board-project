<style>
  /* 페이지 전용(최소) - layout.ejs 토큰(색/보더)을 그대로 활용 */
  .page-card{
    border: 1px solid var(--border);
    border-radius: 12px;
    background: #fff;
    padding: 16px;
  }

  .page-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }

  .page-head h2{
    margin:0;
    font-size: 18px;
    font-weight: 650;
    letter-spacing: -0.01em;
  }
  .page-head .sub{
    margin: 2px 0 0;
    font-size: 12.5px;
    color: var(--muted);
  }

  .head-actions{
    display:flex;
    gap:8px;
    flex-wrap: wrap;
    align-items:center;
    justify-content:flex-end;
  }

  .search-form{
    display:flex;
    gap:8px;
    flex-wrap: wrap;
    align-items:center;
    width:100%;
  }
  .search-form input[type="text"]{
    height: 36px;
    padding: 0 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #fff;
    min-width: 260px;
  }
  .search-form input[type="text"]:focus{
    outline:none;
    border-color: var(--text);
    box-shadow: var(--ring);
  }

  /* ✅ 테이블 래퍼는 overflow + 상단 구분선만 (외곽 박스는 page-card가 담당) */
  .table-scroll{
    overflow-x:auto;
    margin-top: 12px;
    border-top: 1px solid var(--border);
    padding-top: 10px;
  }

  table{
    width:100%;
    border-collapse: collapse;
    min-width: 860px;
  }
  thead th{
    background: var(--bg);
    color: var(--text);
    font-weight: 600;
    font-size: 12.5px;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    text-align:left;
    white-space: nowrap;
  }
  tbody td{
    font-size: 13px;
    padding: 10px 12px;
    border-bottom: 1px solid var(--border);
    vertical-align: middle;
  }
  tbody tr:hover{ background: var(--bg); }

  .text-center{ text-align:center; }
  .text-right{ text-align:right; }

  .link{
    color: var(--text);
    text-decoration:none;
    font-weight: 600;
  }
  .link:hover{ text-decoration: underline; }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    line-height: 1;
  }

  .action-buttons{
    display:flex;
    gap:6px;
    white-space: nowrap;
    justify-content: flex-start;
  }
  .icon-btn{
    width: 34px;
    height: 34px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #fff;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    padding:0;
  }
  .icon-btn:hover{ background: var(--bg); }
  .icon-btn img{ width: 16px; height: 16px; display:block; }

  .col-center { text-align: center; }
</style>

  <div class="page-head">
      <div class="head-actions">
      <a href="/" class="btn">메인</a>
      <a href="/client/new" class="btn btn-primary">거래처 등록</a>

      <button type="button" class="btn btn-outline-primary" id="btnBulkClientOpen">
        거래처 일괄등록
      </button>
    </div>

    <form method="GET" action="/client" class="search-form">
      <input type="text" name="q" value="<%= q %>" placeholder="거래처명/사업자번호/전화 검색" />
      <button type="submit" class="btn">검색</button>
      <button type="button" class="btn" onclick="window.location.href='/client'">새로고침</button>
    </form>
  </div>

  <% if (!clients || clients.length === 0) { %>
    <div style="color: var(--muted); font-size: 13px;">
      등록된 거래처가 없습니다. 우측의 “거래처 등록” 버튼으로 추가하세요.
    </div>
  <% } else { %>
    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th style="width:70px;">ID</th>
            <th>거래처명</th>
            <th class="col-center" style="width:160px;">사업자번호</th>
            <th class="col-center" style="width:120px;">대표자</th>
            <th class="col-center" style="width:140px;">전화</th>
            <th style="width:120px;"></th>
          </tr>
        </thead>

        <tbody>
        <% clients.forEach(c => { %>
          <tr>
            <td class="text-center"><%= c.id %></td>
            <td><a class="link" href="/client/<%= c.id %>/edit"><%= c.name %></a></td>
            <td class="col-center"><%= c.biz_no || "" %></td>
            <td class="col-center"><%= c.ceo_name || "" %></td>
            <td class="col-center"><%= c.phone || "" %></td>

            <td>
              <div class="action-buttons">
                <a href="/client/<%= c.id %>/edit" class="icon-btn" title="수정">
                  <img src="/icons/edit.png" alt="수정" />
                </a>

                <form method="POST" action="/client/<%= c.id %>/delete" style="display:inline;">
                  <button type="submit" class="icon-btn" title="삭제" onclick="return confirm('삭제할까요?')">
                    <img src="/icons/delete.png" alt="삭제" />
                  </button>
                </form>
              </div>
            </td>
          </tr>
        <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>

<!-- ✅ 모달은 레이아웃에 영향 없도록 page-card 밖(또는 맨 아래)에 둡니다 -->
<div class="modal" id="bulkClientModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">거래처 일괄등록</h5>
        <button type="button" class="btn-close" data-close="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="alert alert-secondary">
          1) 엑셀 양식을 다운로드 후<br/>
          2) 작성한 파일을 업로드하면 거래처가 일괄 등록됩니다.
        </div>

        <div class="d-flex gap-2 mb-3">
          <a class="btn btn-outline-secondary" href="/client/template">엑셀 양식 다운로드</a>
        </div>

        <form id="bulkClientForm" action="/client/upload" method="post" enctype="multipart/form-data">
          <div class="mb-2">
            <label class="form-label">엑셀 파일 선택</label>
            <input class="form-control" type="file" name="file" accept=".xlsx,.xls" required>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">엑셀 업로드</button>
            <button type="button" class="btn btn-light" data-close="modal">취소</button>
          </div>
        </form>

        <div class="mt-3" id="bulkClientResult" style="display:none;"></div>
      </div>

    </div>
  </div>
</div>

<script>
  const modal = document.getElementById('bulkClientModal');

  function openModal() {
    modal.style.display = 'block';
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    modal.style.display = 'none';
    modal.classList.remove('show');
    document.body.style.overflow = '';
  }

  document.getElementById('btnBulkClientOpen').addEventListener('click', openModal);

  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  modal.querySelectorAll('[data-close="modal"]').forEach(btn => {
    btn.addEventListener('click', closeModal);
  });
</script>

<style>
  .modal { position: fixed; inset: 0; background: rgba(0,0,0,.35); display:none; z-index: 9999; }
  .modal.show { display:block; }
  .modal-dialog { margin: 6vh auto; max-width: 900px; }
  .modal-content { background:#fff; border-radius: 10px; overflow:hidden; }
  .modal-header,.modal-body { padding: 16px; }
  .btn-close { border:0; background:transparent; font-size: 20px; cursor:pointer; }
</style>
