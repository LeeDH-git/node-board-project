<!-- views/progress_show.ejs -->
<div class="page-head">
  <div>
    <div class="page-title">
      <%= headerTitle || '기성 상세' %>
    </div>
    <div class="page-sub">
      <%= headerSub || '' %>
    </div>
  </div>
  <div class="page-actions">
    <%- headerAction || '' %>
  </div>
</div>

<div class="card">
  <div class="c-kv-grid">
    <div class="c-kv">
      <div class="c-k">계약번호</div>
      <div class="c-v">
        <a class="link" href="/contract/<%= progress.contract_id %>">
          <%= progress?.contract_no || '-' %>
        </a>
      </div>
    </div>

    <div class="c-kv">
      <div class="c-k">계약명</div>
      <div class="c-v">
        <%= progress?.contract_title || '-' %>
      </div>
    </div>

    <div class="c-kv">
      <div class="c-k">발주처</div>
      <div class="c-v">
        <%= progress?.contract_client_name || '-' %>
      </div>
    </div>

    <!-- ✅ 기성회차 -->
    <div class="c-kv">
      <div class="c-k">기성회차</div>
      <div class="c-v">
        <%= progress?.progress_round ? (progress.progress_round + '차' ) : '-' %>
      </div>
    </div>

    <div class="c-kv">
      <div class="c-k">기성월</div>
      <div class="c-v">
        <%= progress?.progress_month || '-' %>
      </div>
    </div>

    <div class="c-kv">
      <div class="c-k">기성금액</div>
      <div class="c-v">
        <%= (progress?.progress_amount || 0).toLocaleString('ko-KR') %> 원
      </div>
    </div>

    <div class="c-kv">
      <div class="c-k">누적기성률</div>
      <div class="c-v">
        <%= (progress?.progress_rate ?? 0).toFixed ? Number(progress.progress_rate).toFixed(2) :
          (progress?.progress_rate || 0) %> %
      </div>
    </div>

    <div class="c-kv span-2">
      <div class="c-k">비고</div>
      <div class="c-v">
        <%= progress?.note || '-' %>
      </div>
    </div>
  </div>

  <div class="divider" style="margin:14px 0;"></div>

  <div class="summary-box">
    <div class="summary-row">
      <div class="muted">계약금액</div>
      <div>
        <%= (summary?.contractTotal || 0).toLocaleString('ko-KR') %> 원
      </div>
    </div>
    <div class="summary-row">
      <div class="muted">전체 누적 기성금액</div>
      <div>
        <%= (summary?.sumPaid || 0).toLocaleString('ko-KR') %> 원
      </div>
    </div>
    <div class="summary-row">
      <div class="muted">전체 잔액</div>
      <div>
        <%= (summary?.balance || 0).toLocaleString('ko-KR') %> 원
      </div>
    </div>
    <div class="summary-row">
      <div class="muted">이 기성까지 누적</div>
      <div>
        <%= (summary?.cumAtThis || 0).toLocaleString('ko-KR') %> 원
      </div>
    </div>
    <div class="summary-row">
      <div class="muted">이 기성까지 잔액</div>
      <div>
        <%= (summary?.balanceAtThis || 0).toLocaleString('ko-KR') %> 원
      </div>
    </div>
    <div class="summary-row">
      <div class="muted">이 기성까지 누적률</div>
      <div>
        <%= (summary?.cumulativeRateAtThis ?? 0).toFixed(2) %> %
      </div>
    </div>
  </div>
</div>