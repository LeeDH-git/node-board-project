<style>
  /* 계약 화면(card) 톤과 동일하게 */
  .card {
    border: 1px solid var(--border);
    border-radius: 12px;
    background: var(--panel);
    padding: 16px;
  }

  .card+.card {
    margin-top: 12px;
  }

  .title {
    margin: 0 0 10px 0;
    font-size: 16px;
    font-weight: 650;
    letter-spacing: -0.01em;
    color: var(--text);
  }

  .meta-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .kv {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 8px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
  }

  .kv:last-child {
    border-bottom: none;
  }

  .k {
    color: var(--muted);
    font-size: 12.5px;
  }

  .v {
    color: var(--text);
    font-size: 13.5px;
    font-weight: 550;
    word-break: break-word;
  }

  /* ===== 견적 테이블 (FHD 최적 / 스크롤 최소화) ===== */
  .table-wrap {
    border: 2px solid rgba(17, 24, 39, 0.18);
    border-radius: 12px;
    background: #fff;
    margin-top: 10px;

    /* 기본은 숨김(스크롤 안 뜨게) */
    overflow-x: hidden;
  }

  table {
    width: 100%;
    border-collapse: collapse;

    /* ✅ A: FHD에서 화면에 맞추기 */
    table-layout: fixed;

    font-size: 12.5px;
    border: 2px solid rgba(17, 24, 39, 0.18);
  }

  thead th {
    background: var(--bg);
    font-weight: 650;
    padding: 10px 8px;
    white-space: nowrap;
    text-align: center;
    border-bottom: 2px solid rgba(17, 24, 39, 0.12);
  }

  tbody td,
  tfoot td {
    padding: 8px 8px;
    text-align: center;
    vertical-align: middle;
    border-bottom: 2px solid rgba(17, 24, 39, 0.08);
    font-variant-numeric: tabular-nums;
  }

  tbody tr:hover {
    background: var(--bg);
  }

  /* 내부 세로선 */
  table th,
  table td {
    border-right: 2px solid rgba(17, 24, 39, 0.10);
  }

  table th:last-child,
  table td:last-child {
    border-right: none;
  }

  /* 최외곽 테두리(상/하/좌/우) 확실하게 */
  table thead tr:first-child th {
    border-top: 2px solid rgba(17, 24, 39, 0.18);
  }

  table tbody tr:last-child td {
    border-bottom: 2px solid rgba(17, 24, 39, 0.18);
  }

  table tfoot tr:last-child td {
    border-bottom: 2px solid rgba(17, 24, 39, 0.18);
  }

  /* 정렬 */
  .text-left {
    text-align: left;
  }

  .text-right {
    text-align: right;
    padding-right: 14px;
    /* 숫자 잘림 방지 */
    white-space: nowrap;
  }

  /* ✅ FHD 컬럼 폭 재배치 (합계/금액 안 잘리게) */
  th.col-name,
  td.col-name {
    width: 16%;
  }

  th.col-spec,
  td.col-spec {
    width: 12%;
  }

  th.col-unit,
  td.col-unit {
    width: 4%;
  }

  th.col-qty,
  td.col-qty {
    width: 5%;
  }

  /* 단가(좁게), 금액(조금 넓게) */
  th.col-mu,
  td.col-mu,
  th.col-lu,
  td.col-lu,
  th.col-eu,
  td.col-eu,
  th.col-tu,
  td.col-tu {
    width: 5.5%;
  }

  th.col-ma,
  td.col-ma,
  th.col-la,
  td.col-la,
  th.col-ea,
  td.col-ea,
  th.col-ta,
  td.col-ta {
    width: 6.5%;
  }

  th.col-note,
  td.col-note {
    width: 9%;
  }

  tr.total-row td {
    font-weight: 700;
    background: var(--bg);
  }

  tfoot td {
    border-top: 2px solid rgba(17, 24, 39, 0.14);
  }

  /* 해상도 줄어들면 그때만 스크롤 허용(안전장치) */
  @media (max-width: 1500px) {
    .table-wrap {
      overflow-x: auto;
    }

    table {
      min-width: 1400px;
    }
  }

  @media (max-width: 900px) {
    .meta-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<% function fmt(n){ if (n===null || n===undefined || n==="" ) return "" ; const num=Number(n); if (isNaN(num)) return n;
  return num.toLocaleString("ko-KR"); } let sumMaterialAmount=0, sumLaborAmount=0, sumExpenseAmount=0, sumTotalAmount=0;
  (items || []).forEach((row)=>{
  sumMaterialAmount += Number(row.material_amount || 0);
  sumLaborAmount += Number(row.labor_amount || 0);
  sumExpenseAmount += Number(row.expense_amount || 0);
  sumTotalAmount += Number(row.total_amount || 0);
  });
  %>

  <div class="card">
    <div class="title">
      <%= estimate.title %>
    </div>

    <div class="meta-grid">
      <div>
        <div class="kv">
          <div class="k">견적번호</div>
          <div class="v">
            <%= estimate.estimate_no || "-" %>
          </div>
        </div>
        <div class="kv">
          <div class="k">거래처</div>
          <div class="v">
            <%= estimate.client_name || "-" %>
          </div>
        </div>
      </div>

      <div>
        <div class="kv">
          <div class="k">견적금액</div>
          <div class="v">
            <%= estimate.total_amount ? estimate.total_amount.toLocaleString("ko-KR") + " 원" : "-" %>
          </div>
        </div>
        <div class="kv">
          <div class="k">등록일</div>
          <div class="v">
            <%= estimate.created_at ? String(estimate.created_at).substring(0,19) : "-" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="title" style="font-size:13px; margin-bottom:8px;">견적 내역</div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th rowspan="2" class="col-name">품명</th>
            <th rowspan="2" class="col-spec">규격</th>
            <th rowspan="2" class="col-unit">단위</th>
            <th rowspan="2" class="col-qty">수량</th>
            <th colspan="2">재료비</th>
            <th colspan="2">노무비</th>
            <th colspan="2">경비</th>
            <th colspan="2">합계</th>
            <th rowspan="2" class="col-note">비고</th>
          </tr>
          <tr>
            <th class="col-mu">단가</th>
            <th class="col-ma">금액</th>
            <th class="col-lu">단가</th>
            <th class="col-la">금액</th>
            <th class="col-eu">단가</th>
            <th class="col-ea">금액</th>
            <th class="col-tu">단가</th>
            <th class="col-ta">금액</th>
          </tr>
        </thead>

        <tbody>
          <% (items || []).forEach(function(row){ %>
            <tr>
              <td class="text-left col-name">
                <%= row.item_name || "" %>
              </td>
              <td class="text-left col-spec">
                <%= row.spec || "" %>
              </td>
              <td class="col-unit">
                <%= row.unit || "" %>
              </td>
              <td class="col-qty text-right">
                <%= fmt(row.qty) %>
              </td>

              <td class="col-mu text-right">
                <%= fmt(row.material_unit) %>
              </td>
              <td class="col-ma text-right">
                <%= fmt(row.material_amount) %>
              </td>

              <td class="col-lu text-right">
                <%= fmt(row.labor_unit) %>
              </td>
              <td class="col-la text-right">
                <%= fmt(row.labor_amount) %>
              </td>

              <td class="col-eu text-right">
                <%= fmt(row.expense_unit) %>
              </td>
              <td class="col-ea text-right">
                <%= fmt(row.expense_amount) %>
              </td>

              <td class="col-tu text-right">
                <%= fmt(row.total_unit) %>
              </td>
              <td class="col-ta text-right">
                <%= fmt(row.total_amount) %>
              </td>

              <td class="text-left col-note">
                <%= row.note || "" %>
              </td>
            </tr>
            <% }) %>
        </tbody>

        <tfoot>
          <tr class="total-row">
            <td colspan="4" class="text-center">합계</td>
            <td></td>
            <td class="text-right">
              <%= fmt(sumMaterialAmount) %>
            </td>
            <td></td>
            <td class="text-right">
              <%= fmt(sumLaborAmount) %>
            </td>
            <td></td>
            <td class="text-right">
              <%= fmt(sumExpenseAmount) %>
            </td>
            <td></td>
            <td class="text-right">
              <%= fmt(sumTotalAmount) %>
            </td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>