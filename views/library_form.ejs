<link rel="stylesheet" href="/css/style.css">

<main id="library_form" class="library-form">
  <div class="page-head">
    <div>
      <div class="page-title">
        <%= doc ? "자료 수정" : "자료 등록" %>
      </div>
      <div class="page-sub">파일을 업로드하고 분류/메모를 남겨 관리하세요</div>
    </div>

    <div class="head-actions">
      <a href="/library" class="btn">목록</a>
      <% if (doc) { %>
        <a href="/library/<%= doc.id %>" class="btn">상세</a>
        <% } %>
    </div>
  </div>

  <% if (doc) { %>
    <form action="/library/<%= doc.id %>/delete" method="post" style="margin:0 0 12px 0;"
      onsubmit="return confirm('정말 삭제하시겠습니까?');">
      <button type="submit" class="btn btn-danger">삭제</button>
    </form>
    <% } %>

      <form method="post" action="<%= doc ? ('/library/' + doc.id + '/edit') : '/library' %>"
        enctype="multipart/form-data">

        <!-- 카드 1: 기본정보 -->
        <div class="c-card">
          <div class="c-title">
            <%= doc ? (doc.title || '자료 수정' ) : '자료 정보' %>
          </div>
          <div class="c-sub">기본 분류 정보를 입력하세요.</div>

          <div class="c-meta">
            <div>
              <div class="c-kv">
                <div class="c-k">제목 <span class="req">*</span></div>
                <div class="c-v">
                  <input class="c-input" type="text" name="title" required value="<%= doc ? (doc.title || '') : '' %>"
                    placeholder="예: 안전교육 자료, 표준서식, 계약서 샘플" />
                </div>
              </div>

              <div class="c-kv">
                <div class="c-k">구분</div>
                <div class="c-v">
                  <select class="c-select" name="doc_type">
                    <option value="form" <%=doc && doc.doc_type==='form' ? 'selected' : '' %>>서식</option>
                    <option value="reference" <%=doc && doc.doc_type==='reference' ? 'selected' : '' %>>자료</option>
                    <option value="safety" <%=doc && doc.doc_type==='safety' ? 'selected' : '' %>>안전</option>
                    <option value="contract" <%=doc && doc.doc_type==='contract' ? 'selected' : '' %>>계약</option>
                  </select>
                </div>
              </div>
            </div>

            <div>
              <div class="c-kv">
                <div class="c-k">카테고리</div>
                <div class="c-v">
                  <input class="c-input" type="text" name="category" value="<%= doc ? (doc.category || '') : '' %>"
                    placeholder="예: 철근, 거푸집, 안전보건, 계약, 노무" />
                </div>
              </div>

              <div class="c-kv">
                <div class="c-k">등록일</div>
                <div class="c-v">
                  <span class="c-muted">
                    <%= doc && doc.created_at ? String(doc.created_at).substring(0,10) : '-' %>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 카드 2: 파일 -->
        <div class="c-card">
          <div class="c-section-title">파일</div>

          <% if (doc && (doc.filename || doc.original_name)) { %>
            <div class="c-kv">
              <div class="c-k">현재 파일</div>
              <div class="c-v">
                <% if (doc.filename) { %>
                  <a class="c-link" href="/uploads/library/<%= doc.filename %>" target="_blank">
                    <%= doc.original_name || doc.filename %>
                  </a>
                  <span class="c-muted">
                    (<%= doc.size ? Math.round(doc.size/1024) + ' KB' : '-' %>)
                  </span>
                  <% } else { %>
                    <span class="c-muted">-</span>
                    <% } %>
              </div>
            </div>
            <% } %>

              <div class="c-kv" style="border-bottom:none;">
                <div class="c-k">파일 업로드</div>
                <div class="c-v">
                  <input class="c-file" type="file" name="file" />
                  <div class="c-help">
                    <% if (doc) { %>
                      새 파일을 선택하면 기존 파일을 대체합니다. (선택하지 않으면 기존 파일 유지)
                      <% } else { %>
                        파일을 선택하지 않아도 등록은 가능합니다. (추후 업로드 가능)
                        <% } %>
                  </div>
                </div>
              </div>
        </div>

        <!-- 카드 3: 메모 -->
        <div class="c-card">
          <div class="c-section-title">메모</div>

          <div class="c-kv" style="border-bottom:none;">
            <div class="c-k">메모</div>
            <div class="c-v">
              <textarea class="c-textarea" name="memo"
                placeholder="사용처/주의사항/버전 등"><%= doc ? (doc.memo || '') : '' %></textarea>
              <div class="c-help">예: 현장 안전교육 시 배포 / 최신본은 2025-12 기준</div>
            </div>
          </div>
        </div>

        <div class="c-footer">
          <a href="/library" class="btn">취소</a>
          <button type="submit" class="btn btn-primary">
            <%= doc ? "수정 저장" : "등록" %>
          </button>
        </div>
      </form>
</main>