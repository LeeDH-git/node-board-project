<!-- 계약 상세 보기 화면: /contract/:id -->

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>계약 상세</h3>
  <div>
    <a href="/contract" class="btn btn-sm btn-secondary mr-2">목록</a>
    <a href="/contract/<%= contract.id %>/edit" class="btn btn-sm btn-primary">수정</a>
    <form
      action="/contract/<%= contract.id %>/delete"
      method="post"
      style="display:inline-block;"
      onsubmit="return confirm('정말 삭제하시겠습니까?');"
    >
      <button type="submit" class="btn btn-sm btn-danger">삭제</button>
    </form>
  </div>
</div>

<!-- 1. 기본 정보 -->
<div class="border rounded p-3 mb-3">
  <h4 class="mb-3"><%= contract.title %></h4>

  <div class="row">
    <div class="col-md-6">
      <dl class="row mb-0">
        <dt class="col-sm-4">계약번호</dt>
        <dd class="col-sm-8"><%= contract.contract_no || '-' %></dd>

        <dt class="col-sm-4">발주처</dt>
        <dd class="col-sm-8"><%= contract.client_name || '-' %></dd>

        <dt class="col-sm-4">계약금액</dt>
        <dd class="col-sm-8">
          <%= contract.total_amount ? contract.total_amount.toLocaleString("ko-KR") + " 원" : '-' %>
        </dd>
      </dl>
    </div>

    <div class="col-md-6">
      <dl class="row mb-0">
        <dt class="col-sm-4">공사기간</dt>
        <dd class="col-sm-8">
          <% if (contract.start_date || contract.end_date) { %>
            <%= contract.start_date || '' %> ~ <%= contract.end_date || '' %>
          <% } else { %>
            -
          <% } %>
        </dd>

        <dt class="col-sm-4">연결 견적 ID</dt>
        <dd class="col-sm-8">
          <% if (contract.estimate_id) { %>
            <%= contract.estimate_id %>
            <!-- 필요하면 견적 상세로 링크 걸기:  -->
            <!-- <a href="/estimate/<%= contract.estimate_id %>">(견적 보기)</a> -->
          <% } else { %>
            -
          <% } %>
        </dd>

        <dt class="col-sm-4">등록일</dt>
        <dd class="col-sm-8"><%= contract.created_at || '-' %></dd>
      </dl>
    </div>
  </div>
</div>

<!-- 2. 본문: PDF / 수기 계약서 병렬 표시 -->
<div class="row">
  <% if (contract.pdf_filename) { %>
    <div class="<%= contract.body_text ? 'col-md-6' : 'col-md-12' %> mb-3">
      <div class="border rounded p-2">
        <h5>계약서 PDF (1페이지 미리보기)</h5>
        <div style="border:1px solid #ddd; border-radius:4px; overflow:hidden;">
          <embed
            src="/uploads/contracts/<%= contract.pdf_filename %>#page=1&zoom=page-width"
            type="application/pdf"
            width="100%"
            height="600px"
          >
        </div>
        <div class="mt-2">
          <a
            href="/uploads/contracts/<%= contract.pdf_filename %>"
            target="_blank"
          >
            전체 PDF 새창으로 열기
          </a>
        </div>
      </div>
    </div>
  <% } %>

  <% if (contract.body_text) { %>
    <div class="<%= contract.pdf_filename ? 'col-md-6' : 'col-md-12' %> mb-3">
      <div class="border rounded p-2">
        <h5>수기 계약서 내용</h5>
        <pre
          style="
            white-space: pre-wrap;
            border: 1px solid #eee;
            padding: 1rem;
            background: #fafafa;
            font-size: 0.9rem;
          "
        ><%= contract.body_text %></pre>
      </div>
    </div>
  <% } %>
</div>

<% if (!contract.pdf_filename && !contract.body_text) { %>
  <p class="text-muted">
    아직 PDF 파일이나 수기 계약서 내용이 등록되지 않았습니다.
  </p>
<% } %>
